Ext.namespace("Motive");Motive.StringUtils=function(){return{isAlphaNumeric:function(s){var exp=new RegExp(/^([ a-zA-Z0-9_-]+)$/);return exp.test(s);},isJSON:function(s){var str=s;if(str.blank())return false;str=this.replace(/\\./g,'@').replace(/"[^"\\\n\r]*"/g,'');return(/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/).test(str);}};}();Motive.FormUtils=function(){return{limitTextInput:function(textElement,maxlength){if(textElement.value.length>maxlength){textElement.value=textElement.value.substring(0,maxlength);}}};}();Ext.namespace("Motive");Motive.Dictionary=function(){var $j=jQuery.noConflict();var ajaxRequest={};var _data=null;var _tinyMCE=null;var _aceEditor=null;var _editorName=null;var _language=null;var _testModulesTree=null;var _endpointOperationsTree=null;var _rpcServicesTree=null;var _environmentPropertiesTree=null;var _applicationPropertiesTree=null;var _activitiesTree=null;var _pocketOfFlexibilitiesTree=null;var _accordionPanel=null;var _isLoaded=false;var _isInitialized=false;var _useScriptDelimiters=true;var _defaultListeners={click:function(node,broserEvent){broserEvent.preventDefault();},dblclick:function(node,broserEvent){broserEvent.preventDefault();if(node.isLeaf()){Motive.Dictionary.insertPropertyRef(node.attributes.href);}}};var _isPropToDisplay=function(propName){var propsToDisplay=["properties","inputs","result","resolution"];var result=propsToCheck.join(",").indexOf(propName);return result>=0;};var _makeScriptRef=function(path){var ref="";if(_useScriptDelimiters&&(_language=='Juel'||_language=='juel')){ref='#{'+path+'}';}else{ref=path;}
return ref};return{TEST_MODULE_PREFIX:"testModules",ACTIVITIES_PREFIX:"result_variable_to_be_replaced",POF_PREFIX:"result_variable_to_be_replaced",SESSION_OBJECTS_PREFIX:"session",ENDPOINT_OPERATION_PREFIX:"endpointOperations",RPC_SERVICES_PREFIX:"rpcServices",ENVIRONMENT_PROPERTY_PREFIX:"environmentProperties",APPLICATION_PROPERTY_PREFIX:"applicationProperties",isLoaded:function(){return _isLoaded;},isInitialized:function(){return _isInitialized;},getData:function(){return _data;},setData:function(data){_data=data;},getDictionaryPanel:function(){return _accordionPanel;},camelCase:function(s){var lower=Ext.util.Format.lowercase(s);var s1=s.trim().gsub(/\s+/,'-').camelize();return s1.sub(s1.charAt(0),lower.charAt(0));},isAllUpperCase:function(stringInQuestion){return(stringInQuestion===stringInQuestion.toUpperCase());},normalizeResultName:function(nameToNormalize){if(nameToNormalize==null){return null;}
var arrayOfNameElements=nameToNormalize.trim().match(/[a-zA-Z0-9]+/g);if(arrayOfNameElements.length<=0){return nameToNormalize;}
var stringBuilder=new Array();var firstNameElement=arrayOfNameElements[0];if(firstNameElement.length>1){if(Motive.Dictionary.isAllUpperCase(firstNameElement)){stringBuilder.push(firstNameElement.toLowerCase());}else{stringBuilder.push(firstNameElement.charAt(0).toLowerCase());stringBuilder.push(firstNameElement.substring(1));}}else{stringBuilder.append(firstNameElement);}
for(var index=1;index<arrayOfNameElements.length;index++){var nameElement=arrayOfNameElements[index];stringBuilder.push(nameElement.charAt(0).toUpperCase());stringBuilder.push(nameElement.substring(1));}
return stringBuilder.toString().replace(/,/g,'');},getLabel:function(o){var label="??unknown??";if(o.displayName!==undefined){label=o.displayName;}else if(o.title!==undefined){label=o.title;}else if(o.name!==undefined){label=o.name}
return label;},insertPropertyRefRaw:function(objId,ref){var txtElem=Ext.getDom(objId);if(txtElem.setSelectionRange){txtElem.value=txtElem.value.substring(0,txtElem.selectionStart)+
ref+
txtElem.value.substring(txtElem.selectionStart,txtElem.selectionEnd)+
txtElem.value.substring(txtElem.selectionEnd,txtElem.value.length);}else if(document.selection&&document.selection.createRange){txtElem.focus();var range=document.selection.createRange();range.text=ref+range.text;}},insertPropertyRef:function(ref){if(_editorName=='tinyMCE'){_tinyMCE.activeEditor.selection.setContent(ref);}else{var result=ref;if(_language=="Javascript"||_language=="javascript"){result=ref.replace(/'/g,"\"");}
_aceEditor.insert(result);_aceEditor.focus();}},load:function(){if(arguments.length==1){_aceEditor=arguments[0];}
if(_isLoaded){Motive.Dictionary.render();return;}
ajaxRequest=$j.ajax({url:ORYX.CONFIG.ROOT_PATH+"scripts/Motive/dictionary.json",}).done(function(response){_data=response;_isLoaded=true;Motive.Dictionary.render();});},cancelPendingOperations:function(){ajaxRequest.abort();},renderProperties:function(properties,parentNode,parentPath){Ext.each(properties,function(prop){var path=null;if(_language=='juel'||_language=='Juel'){path=parentPath+"['"+prop.name+"']";}
else{path=parentPath+".get('"+prop.name+"')";}
var isLeaf=(prop.properties!==undefined&&prop.properties.length>0)?false:true;var iconClass=(isLeaf)?'icon-tag':'icon-scriptcode';var propNode=new Ext.tree.TreeNode({href:_makeScriptRef(path),text:Motive.Dictionary.getLabel(prop),leaf:isLeaf,iconCls:iconClass,draggable:false,allowDrag:false,allowDrop:false,listeners:_defaultListeners});parentNode.appendChild(propNode);if(!isLeaf&prop.properties!==undefined){var pathSuffix=(prop.dataType!==undefined&&prop.dataType==="List")?"[i]":"";var newPath=path+pathSuffix;ORYX.Log.debug("Motive.Dictionary.renderProperties: prop.dataType = "+prop.dataType+",listSuffix = "+pathSuffix+",newPath = "+newPath);Motive.Dictionary.renderProperties(prop.properties,propNode,newPath);}});},renderInputs:function(inputs,parentNode,parentPath){Ext.each(inputs,function(input){var path=parentPath+"['"+input.name+"']";var inputNode=new Ext.tree.TreeNode({href:_makeScriptRef(path),text:Motive.Dictionary.getLabel(input),leaf:true,iconCls:'icon-tag',draggable:false,allowDrag:false,allowDrop:false,listeners:_defaultListeners});parentNode.appendChild(inputNode);});},renderResolution:function(resolution,parentNode,parentPath){Ext.each(resolution,function(res){var path=parentPath+"['"+res.name+"']";var resNode=new Ext.tree.TreeNode({href:_makeScriptRef(path),text:Motive.Dictionary.getLabel(res),leaf:true,iconCls:'icon-tag',draggable:false,allowDrag:false,allowDrop:false,listeners:_defaultListeners});parentNode.appendChild(resNode);});},renderResult:function(result,parentNode,parentPath){var path=parentPath+"['"+result.name+"']";var resNode=new Ext.tree.TreeNode({href:_makeScriptRef(path),text:Motive.Dictionary.getLabel(result),leaf:true,iconCls:'icon-tag',draggable:false,allowDrag:false,allowDrop:false,listeners:_defaultListeners});parentNode.appendChild(resNode);},render:function(){var path=null;var pathPrefix=null;if(_data.testModules!=null){if(_language=='juel'||_language=='Juel'){Ext.each(_data.testModules,function(tm){pathPrefix=Motive.Dictionary.TEST_MODULE_PREFIX+"['"+tm.id+"']";if(tm.isOverlayTypeRegistered!==undefined&&tm.isOverlayTypeRegistered==true){pathPrefix=pathPrefix+"['properties']";}
var tmNode=new Ext.tree.TreeNode({text:Motive.Dictionary.getLabel(tm),iconCls:'icon-script',draggable:false,allowDrag:false,allowDrop:false});if(tm.properties!==undefined&&tm.properties.length>0){Motive.Dictionary.renderProperties(tm.properties,tmNode,pathPrefix);}
_testModulesTree.root.appendChild(tmNode);});}
else{Ext.each(_data.testModules,function(tm){pathPrefix="execution.getVariable('"+Motive.Dictionary.TEST_MODULE_PREFIX+"').get('"+tm.id+"')";if(tm.isOverlayTypeRegistered!==undefined&&tm.isOverlayTypeRegistered==true){pathPrefix=pathPrefix+".get('properties')";}
var tmNode=new Ext.tree.TreeNode({text:Motive.Dictionary.getLabel(tm),iconCls:'icon-script',draggable:false,allowDrag:false,allowDrop:false});if(tm.properties!==undefined&&tm.properties.length>0){Motive.Dictionary.renderProperties(tm.properties,tmNode,pathPrefix);}
_testModulesTree.root.appendChild(tmNode);});}}
if(_data.activities!=null){if(_language=='juel'||_language=='Juel'){Ext.each(_data.activities,function(tm){pathPrefix=Motive.Dictionary.ACTIVITIES_PREFIX;var tmNode=new Ext.tree.TreeNode({text:Motive.Dictionary.getLabel(tm),iconCls:'icon-script',draggable:false,allowDrag:false,allowDrop:false});if(tm.outputs!==undefined&&tm.outputs.length>0){Motive.Dictionary.renderProperties(tm.outputs,tmNode,pathPrefix);}
_activitiesTree.root.appendChild(tmNode);});}
else{Ext.each(_data.activities,function(tm){pathPrefix="execution.getVariable('"+Motive.Dictionary.ACTIVITIES_PREFIX+"')";var tmNode=new Ext.tree.TreeNode({text:Motive.Dictionary.getLabel(tm),iconCls:'icon-script',draggable:false,allowDrag:false,allowDrop:false});if(tm.outputs!==undefined&&tm.outputs.length>0){Motive.Dictionary.renderProperties(tm.outputs,tmNode,pathPrefix);}
_activitiesTree.root.appendChild(tmNode);});}}
if(_data.pofs!=null){if(_language=='juel'||_language=='Juel'){Ext.each(_data.pofs,function(tm){pathPrefix=Motive.Dictionary.POF_PREFIX;var tmNode=new Ext.tree.TreeNode({text:Motive.Dictionary.getLabel(tm),iconCls:'icon-script',draggable:false,allowDrag:false,allowDrop:false});if(tm.outputs!==undefined&&tm.outputs.length>0){Motive.Dictionary.renderProperties(tm.outputs,tmNode,pathPrefix);}
_pocketOfFlexibilitiesTree.root.appendChild(tmNode);});}
else{Ext.each(_data.pofs,function(tm){pathPrefix="execution.getVariable('"+Motive.Dictionary.POF_PREFIX+"')";var tmNode=new Ext.tree.TreeNode({text:Motive.Dictionary.getLabel(tm),iconCls:'icon-script',draggable:false,allowDrag:false,allowDrop:false});if(tm.outputs!==undefined&&tm.outputs.length>0){Motive.Dictionary.renderProperties(tm.outputs,tmNode,pathPrefix);}
_pocketOfFlexibilitiesTree.root.appendChild(tmNode);});}}
var epoCounter=0;if(_data.endpointOperations!=null){if(_language=='juel'||_language=='Juel'){Ext.each(_data.endpointOperations,function(ep){pathPrefix=Motive.Dictionary.ENDPOINT_OPERATION_PREFIX+"['"+ep.name+"']";var epNode=new Ext.tree.TreeNode({text:Motive.Dictionary.getLabel(ep),iconCls:'icon-script',draggable:false,allowDrag:false,allowDrop:false});if(ep.properties!==undefined&&ep.properties.length>0){Motive.Dictionary.renderProperties(ep.properties,epNode,pathPrefix);}
_endpointOperationsTree.root.appendChild(epNode);epoCounter++;});}
else{Ext.each(_data.endpointOperations,function(ep){pathPrefix="execution.getVariable('"+Motive.Dictionary.ENDPOINT_OPERATION_PREFIX+"').get('"+ep.name+"')";var epNode=new Ext.tree.TreeNode({text:Motive.Dictionary.getLabel(ep),iconCls:'icon-script',draggable:false,allowDrag:false,allowDrop:false});if(ep.properties!==undefined&&ep.properties.length>0){Motive.Dictionary.renderProperties(ep.properties,epNode,pathPrefix);}
_endpointOperationsTree.root.appendChild(epNode);epoCounter++;});}}
if(epoCounter<1){_accordionPanel.remove("epo-tree",true);_accordionPanel.doLayout();}
var rpcCounter=0;if(_data.rpcServices!=null){Ext.each(_data.rpcServices,function(rpcService){var rpcServiceNode=new Ext.tree.TreeNode({text:Motive.Dictionary.getLabel(rpcService),iconCls:'icon-script',draggable:false,allowDrag:false,allowDrop:false});if(_language=='juel'||_language=='Juel'){Ext.each(rpcService.operations,function(rpcOperation){pathPrefix=Motive.Dictionary.RPC_SERVICES_PREFIX+"['"+rpcService.name+"']['"+rpcOperation.name+"']";var rpcOperationNode=new Ext.tree.TreeNode({text:Motive.Dictionary.getLabel(rpcOperation),iconCls:'icon-script',draggable:false,allowDrag:false,allowDrop:false});if(rpcOperation.results!==undefined){Motive.Dictionary.renderProperties(rpcOperation.results,rpcOperationNode,pathPrefix);}
rpcServiceNode.appendChild(rpcOperationNode);});}else{Ext.each(rpcService.operations,function(rpcOperation){pathPrefix="execution.getVariable('"+Motive.Dictionary.RPC_SERVICES_PREFIX+"').get('"+rpcService.name+"').get('"+rpcOperation.name+"')";var rpcOperationNode=new Ext.tree.TreeNode({text:Motive.Dictionary.getLabel(rpcOperation),iconCls:'icon-script',draggable:false,allowDrag:false,allowDrop:false});if(rpcOperation.results!==undefined){Motive.Dictionary.renderProperties(rpcOperation.results,rpcOperationNode,pathPrefix);}
rpcServiceNode.appendChild(rpcOperationNode);});}
_rpcServicesTree.root.appendChild(rpcServiceNode);rpcCounter++;});}
if(rpcCounter<1){_accordionPanel.remove("rpc-tree",true);_accordionPanel.doLayout();}
if(_data.environmentProperties!=null){if(_language=='juel'||_language=='Juel'){Motive.Dictionary.renderProperties(_data.environmentProperties,_environmentPropertiesTree.root,Motive.Dictionary.ENVIRONMENT_PROPERTY_PREFIX);}
else{pathPrefix="execution.getVariable('"+Motive.Dictionary.ENVIRONMENT_PROPERTY_PREFIX+"')";Motive.Dictionary.renderProperties(_data.environmentProperties,_environmentPropertiesTree.root,pathPrefix);}}
if(_data.applicationProperties!=null){if(_language=='juel'||_language=='Juel'){Motive.Dictionary.renderProperties(_data.applicationProperties,_applicationPropertiesTree.root,Motive.Dictionary.APPLICATION_PROPERTY_PREFIX);}
else{pathPrefix="execution.getVariable('"+Motive.Dictionary.APPLICATION_PROPERTY_PREFIX+"')";Motive.Dictionary.renderProperties(_data.applicationProperties,_applicationPropertiesTree.root,pathPrefix);}}},init:function(cfg){_tinyMCE=cfg.editor;_editorName=cfg.editorName;_language=cfg.language;_useScriptDelimiters=cfg.useScriptDelimiters!=null?cfg.useScriptDelimiters:true;_testModulesTree=new Ext.tree.TreePanel({id:'tm-tree',title:'Test Modules',rootVisible:false,lines:false,autoScroll:true,root:new Ext.tree.TreeNode({text:'Test Modules'})});_activitiesTree=new Ext.tree.TreePanel({id:'actv-tree',title:'Activities',rootVisible:false,lines:false,autoScroll:true,root:new Ext.tree.TreeNode({text:'Activities'})});_pocketOfFlexibilitiesTree=new Ext.tree.TreePanel({id:'pof-tree',title:'Pocket of Flexibility',rootVisible:false,lines:false,autoScroll:true,root:new Ext.tree.TreeNode({text:'Pocket of Flexibility'})});_endpointOperationsTree=new Ext.tree.TreePanel({id:'epo-tree',title:'Endpoint Operations',rootVisible:false,lines:false,autoScroll:true,root:new Ext.tree.TreeNode({text:'Endpoint Operations'})});_rpcServicesTree=new Ext.tree.TreePanel({id:'rpc-tree',title:'RPC Operations',rootVisible:false,lines:false,autoScroll:true,root:new Ext.tree.TreeNode({text:'RPC Operations'})});_applicationPropertiesTree=new Ext.tree.TreePanel({id:'app-tree',title:'Application Properties',rootVisible:false,lines:false,autoScroll:true,root:new Ext.tree.TreeNode({text:'Application Properties'})});_environmentPropertiesTree=new Ext.tree.TreePanel({id:'env-tree',title:'Environment Properties',rootVisible:false,lines:false,autoScroll:true,root:new Ext.tree.TreeNode({text:'Environment Properties'})});_accordionPanel=new Ext.Panel({region:'east',id:'dictionary-accordion-panel',title:'Object Browser',split:true,width:200,minSize:200,maxSize:400,collapsible:false,margins:'0 0 0 0',layout:'accordion',layoutConfig:{animate:true},items:[_activitiesTree,_pocketOfFlexibilitiesTree,_testModulesTree,_endpointOperationsTree,_rpcServicesTree,_applicationPropertiesTree,_environmentPropertiesTree]});_isInitialized=true;},destroy:function(){try{_testModulesTree.destroy();_activitiesTree.destroy();_pocketOfFlexibilitiesTree.destroy();_endpointOperationsTree.destroy();_rpcServicesTree.destroy();_applicationPropertiesTree.destroy();_environmentPropertiesTree.destroy();_accordionPanel.destroy();}catch(e){ORYX.Log.warn("An error occurred destroying the dictionary: "+e);}}};}();Ext.namespace("Motive");Motive.CommonPublishHandler=function(){return{success:function(caller,arguments){this.caller=caller;var response=arguments[0];if(arguments[1]==undefined||arguments[1]==null||arguments[1]==false)
{this.ignoreParentFlows=false;this.cancelRequested=false;}
else this.ignoreParentFlows=true;this.model_id=arguments[2];this.caller_id=arguments[3];if(this.caller_id=='mgr')
{this.caller.store.reload();this.caller.loadmask.hide();}
var responseObj=Ext.util.JSON.decode(response.responseText);var managerFacade=window.RepositoryCore.getFacade();if(managerFacade!=null&&responseObj.parents!=null){managerFacade.applyFilter();managerFacade.modelCache.setData(managerFacade.getDisplayedModels(),"/meta",null,function(){managerFacade.applyFilter()});managerFacade.modelCache.setGetData(managerFacade.getDisplayedModels(),"/access",null,function(){managerFacade.applyFilter()});}
var subflowName=responseObj.subflowName;if((responseObj.parents!=null&&responseObj.parents.length>0)&&this.ignoreParentFlows==false){var data=[];responseObj.parents.each(function(parent){data.push(["model/"+parent.id,parent.name,"not published","",parent.guid])}.bind(this));var store=new Ext.data.SimpleStore({fields:['id','title','state','puberrors','guid'],data:data});var hinderSelection=false;var checkBoxSelMod=new Ext.grid.CheckboxSelectionModel({id:'pub',width:30,checkOnly:true,forceCtrl:true,listeners:{beforerowselect:function(sm,rowIndex,keepExisting,record){if(hinderSelection){hinderSelection=false;return false;}}},selectRow:function(index,keepExisting,preventViewNotify,bypassRowselectEvent){if(this.locked||(index<0||index>=this.grid.store.getCount()))return;var r=this.grid.store.getAt(index);if(r&&(bypassRowselectEvent||this.fireEvent("beforerowselect",this,index,keepExisting,r)!==false)){this.selections.add(r);this.last=this.lastActive=index;if(!preventViewNotify){this.grid.getView().onRowSelect(index);}
this.fireEvent("rowselect",this,index,r);this.fireEvent("selectionchange",this);}},deselectRow:function(index,keepExisting,preventViewNotify,bypassRowdeselectEvent){if(this.locked||(index<0||index>=this.grid.store.getCount()))return;var r=this.grid.store.getAt(index);if(r&&(bypassRowdeselectEvent||this.fireEvent("beforerowselect",this,index,keepExisting,r)!==false)){this.selections.remove(r);if(this.last==index){this.last=false;}
if(this.lastActive==index){this.lastActive=false;}
if(!preventViewNotify){this.grid.getView().onRowDeselect(index);}
this.fireEvent("rowdeselect",this,index,r);this.fireEvent("selectionchange",this);}},selectAll:function(){for(var i=0,len=this.grid.store.getCount();i<len;i++){this.selectRow(i,true,false,true);}
return;},clearSelections:function(){for(var i=0,len=this.grid.store.getCount();i<len;i++){this.deselectRow(i,true,false,true);}
return;},sortable:true});var colModel=new Ext.grid.ColumnModel([checkBoxSelMod,{id:"id",header:"",sortable:false,hidden:true,dataIndex:"id"},{id:"title",header:MOTV.I18N.SubflowPublish.parentHeader,sortable:true,dataIndex:"title",renderer:function(val,metadata,record,rowIndex,colIndex,store){var flowLink=ORYX.PATH+'poem/'+record.get("id")+"/self?activeversion=true";return"<a href='"+flowLink+"' target='_blank'>"+Ext.util.Format.htmlEncode(val)+"</a>";}},{id:"state",width:25,header:MOTV.I18N.SubflowPublish.stateHeader,sortable:true,dataIndex:"state",renderer:function(value,metaData,record,rowIndex,colIndex,store){switch(record.data.state){case'to be published':metaData.css='to-be-published';break;case'not published':metaData.css='not-published';break;case'completed':metaData.css='publish-completed';break;case'failed':metaData.css='publish-failed';break;case'in progress':metaData.css='publish-in-progress';break;}
return'';}},{id:"puberrors",header:"",sortable:false,hidden:true,dataIndex:"puberrors"},{id:"guid",header:"",sortable:false,hidden:true,dataIndex:"guid"}]);this.fmGrid=new Ext.grid.GridPanel({id:'pubs-grid',store:store,border:false,selModel:checkBoxSelMod,enableColumnHide:true,header:true,colModel:colModel,viewConfig:{forceFit:true},listeners:{rowmousedown:function(){hinderSelection=true;},rowdblclick:this._onDblClick.bind(this),cellclick:this._onCellClick.bind(this)},region:"center",iconCls:'icon-grid',enableHdMenu:false});this.fmGrid.getSelectionModel().addListener("rowselect",this._onRowSelect.bind(this));this.fmGrid.getSelectionModel().addListener("rowdeselect",this._onRowDeselect.bind(this));this.doneButton=new Ext.Button({text:MOTV.I18N.SubflowPublish.publishDoneButton,handler:function(){this.mappingWindow.hide();}.bind(this)});this.publishButton=new Ext.Button({text:MOTV.I18N.SubflowPublish.publishParentButton,handler:this._onPublishParents.bind(this)});this.cancelButton=new Ext.Button({text:MOTV.I18N.SubflowPublish.publishCancelButton,handler:this._onCancelPublish.bind(this)});var txtPanel=new Ext.Panel({region:"north",height:18,bodyStyle:"background-color: #CCCCCC",items:[{html:MOTV.I18N.SubflowPublish.panelTitle1+subflowName+MOTV.I18N.SubflowPublish.panelTitle2}]});this.mappingWindow=new Ext.Window({layout:'border',autoCreate:true,title:MOTV.I18N.SubflowPublish.windowTitle+subflowName,height:480,width:600,modal:true,collapsible:false,closable:false,fixedcenter:true,shadow:true,proxyDrag:true,keys:[{key:27,fn:function(){this.mappingWindow.hide()}.bind(this)}],items:[txtPanel,this.fmGrid],listeners:{hide:{"fn":function(){},scope:this},show:{fn:function(){},scope:this}},buttons:[this.publishButton,this.doneButton,this.cancelButton]});this.cancelButton.disable();this.mappingWindow.show();this.fmGrid.getSelectionModel().selectAll();}else{if(this.ignoreParentFlows==true)
{var regexpValue=responseObj.modelUri.slice(1,responseObj.modelUri.length);var recordIndex=this.fmGrid.getStore().find("id",regexpValue);var record=this.fmGrid.getStore().getAt(recordIndex);record.set("state","completed");this.fmGrid.getView().refreshRow(record);this._publishNextParent();}
else
{if(this.caller_id=='mgr')
{this.caller.loadmask.msg="Published!";this.caller.loadmask.show();var loadmask=this.caller.loadmask;window.setTimeout(function(){loadmask.hide();},2000);}
else
Ext.MessageBox.alert(MOTV.I18N.PublishPlugin.title,MOTV.I18N.PublishPlugin.publishSuccess);}}},_onRowSelect:function(sm,idx,rec){if(this.publishInProgress!=undefined&&this.publishInProgress==true){return;}
rec.set('state',"to be published");this.fmGrid.getView().refreshRow(rec);if(this.fmGrid.getSelectionModel().getSelections().length){this.publishButton.enable();}
return;},_onRowDeselect:function(sm,idx,rec){if(this.publishInProgress!=undefined&&this.publishInProgress==true){return;}
if(rec.get("state")=="to be published"){rec.set('state',"not published");this.fmGrid.getView().refreshRow(rec);}
if(!this.fmGrid.getSelectionModel().getSelections().length){this.publishButton.disable();}
return;},_onDblClick:function(grid,rowIndex,e){return;},_onCellClick:function(grid,rowIndex,columnIndex,e){var record=grid.getStore().getAt(rowIndex);if(columnIndex==3)
{var data=record.get("state");if(data=="failed")
{var msg=record.get("puberrors");if(msg!=undefined&&msg!=null&&msg!="")
{Ext.Msg.show({title:MOTV.I18N.ValidatePlugin.title,msg:msg,buttons:Ext.Msg.OK,minWidth:500,icon:Ext.MessageBox.ERROR,fn:function(btn,text){if(btn=='ok'){}}});}}}
else if(columnIndex==0)
{if(record.get("state")=="in progress")
return;if(this.fmGrid.getSelectionModel().isSelected(rowIndex))
this.fmGrid.getSelectionModel().deselectRow(rowIndex,true,false,true);else this.fmGrid.getSelectionModel().selectRow(rowIndex,true,false,true);}
return;},_onCancelPublish:function(){if(this.cancelRequested==true)
return;if(this.publishInProgress!=undefined&&this.publishInProgress==true){var selections=this.fmGrid.getSelectionModel().getSelections();if(selections!=undefined&&selections!=null&&selections.length>1)
{this.cancelRequested=true;Ext.Msg.show({title:MOTV.I18N.SubflowPublish.cancelAcceptedTitle,msg:MOTV.I18N.SubflowPublish.cancelAcceptedText,buttons:Ext.Msg.OK});}}},_onPublishParents:function(){this.publishButton.disable();this.doneButton.disable();this.cancelButton.enable();this.publishInProgress=true;var recSelected=this.fmGrid.getSelectionModel().getSelections();this.totalSelected=recSelected.length;for(var i=0;i<10;i++){var rec=recSelected[i];if(rec!=undefined&&rec!=null)
{rec.set("state","in progress");this.fmGrid.getView().refreshRow(rec);var recordIndex=this.fmGrid.getStore().find("id",rec.get("id"));this.fmGrid.getSelectionModel().deselectRow(recordIndex,true,false,true);if(this.caller_id=='bld')
this.caller._doValidate(rec.get("id"),true);else
this.caller.validateVersion('-1',rec.get("id"),true);}
else{break;}};},_publishNextParent:function(){this.totalSelected--;var rec=this.fmGrid.getSelectionModel().getSelected();if(rec!=undefined&&rec!=null)
{if(this.cancelRequested!=undefined&&this.cancelRequested!=null&&this.cancelRequested==true)
{this.publishInProgress=false;this.publishButton.enable();this.doneButton.enable();this.cancelButton.disable();this.cancelRequested=false;return;}
rec.set("state","in progress");this.fmGrid.getView().refreshRow(rec);var recordIndex=this.fmGrid.getStore().find("id",rec.get("id"));this.fmGrid.getSelectionModel().deselectRow(recordIndex,true,false,true);if(this.caller_id=='bld')
this.caller._doValidate(rec.get("id"),true);else
this.caller.validateVersion('-1',rec.get("id"),true);}
else{if(this.totalSelected<=0){Ext.Msg.show({title:MOTV.I18N.SubflowPublish.publishDoneTitle,msg:MOTV.I18N.SubflowPublish.publishDoneText,buttons:Ext.Msg.OK});this.publishInProgress=false;this.publishButton.enable();this.doneButton.enable();this.cancelButton.disable();}
return;}},failure:function(caller,arguments){this.caller=caller;var response=arguments[0];if(arguments[1]==undefined||arguments[1]==null||arguments[1]==false)
{this.ignoreParentFlows=false;this.cancelRequested=false;}
else this.ignoreParentFlows=true;this.model_id=arguments[2];this.caller_id=arguments[3];this.isPublic=true;if(this.caller_id=='mgr')
this.caller.loadmask.hide();var errObj={};var msg="";var msg2="";if(response.status==-1){var timeoutMsg=String.format(MOTV.I18N.PublishPlugin.timeoutMsg,ORYX.CONFIG.PUBLISH_TIMEOUT/1000/60);msg=String.format(MOTV.I18N.PublishPlugin.publishFailure,timeoutMsg);msg2=msg;}else{try{errObj=Ext.util.JSON.decode(response.responseText);if(errObj!==undefined){if(errObj.errorMessage=="Workflow must be made public to be published"){this.isPublic=false;}else{msg=String.format(MOTV.I18N.PublishPlugin.publishFailure,errObj.errorMessage);msg=msg.replace(/(:)\s\S*(:)/gi,': ');msg=msg.replace(/Error/g,'<br /><br />Error');msg2=msg;if(errObj.extendedError){msg+=" <a href='#' onclick='Ext.get(this).parent().child(\"#extended-error-info\").setVisibilityMode(Ext.Element.DISPLAY).toggle(); return false;'>More</a><pre id='extended-error-info' style='display:none;overflow:auto;width:100%;height:200px;margin-top:5px'>"+Ext.util.Format.htmlEncode(errObj.extendedError)+"</pre>";}}}}catch(e){ORYX.Log.error("ORYX.Plugins.MotivePlugin._doPublish()::An unexpected error has occurred. Possibly the request timed out.");}}
if(msg===""){msg=String.format(MOTV.I18N.PublishPlugin.publishFailure,MOTV.I18N.PublishPlugin.unexpectedError);msg2=msg;}
if(this.caller_id=='bld')
this.caller.facade.raiseEvent({type:ORYX.CONFIG.EVENT_LOADING_DISABLE,text:msg});if(!this.isPublic){Ext.Msg.show({title:MOTV.I18N.PublishPlugin.title,msg:MOTV.I18N.PublishPlugin.makePublicQuestion,buttons:Ext.Msg.YESNO,minWidth:400,icon:Ext.MessageBox.QUESTION,fn:function(btn,text){if(btn=='yes'){this.caller._doForcePublish(this.model_id,this.ignoreParentFlows);}}.bind(this)});}
else if(this.ignoreParentFlows==false){Ext.Msg.show({title:MOTV.I18N.PublishPlugin.title,msg:msg,buttons:Ext.Msg.OK,minWidth:500,icon:Ext.MessageBox.ERROR,fn:function(btn,text){}});}
else{var regexpValue=errObj.errorData.modelUri.slice(1,errObj.errorData.modelUri.length);var recordIndex=this.fmGrid.getStore().find("id",regexpValue);var rec=this.fmGrid.getStore().getAt(recordIndex);rec.set("puberrors",msg2);rec.set("state","failed");this.fmGrid.getView().refreshRow(rec);this._publishNextParent();}},validatefailure:function(caller,arguments){this.caller=caller;var response=arguments[0];if(arguments[1]==undefined||arguments[1]==null||arguments[1]==false)
{this.ignoreParentFlows=false;this.cancelRequested=false;}
else this.ignoreParentFlows=true;this.model_id=arguments[2];this.caller_id=arguments[3];this.isPublic=true;if(this.caller_id=='mgr')
this.caller.loadmask.hide();var errObj={};var msg="";var msg2="";if(response.status==-1){var timeoutMsg=String.format(MOTV.I18N.ValidatePlugin.timeoutMsg,ORYX.CONFIG.PUBLISH_TIMEOUT/1000/60);msg=String.format(MOTV.I18N.ValidatePlugin.validateFailure,timeoutMsg);msg2=msg;}else{try{errObj=Ext.util.JSON.decode(response.responseText);if(errObj!==undefined){msg=String.format(MOTV.I18N.ValidatePlugin.validateFailure,errObj.errorMessage);msg=msg.replace(/(:)\s\S*(:)/gi,': ');msg=msg.replace(/Error/g,'<br /><br />Error');msg2=msg;if(errObj.extendedError){msg+=" <a href='#' onclick='Ext.get(this).parent().child(\"#extended-error-info\").setVisibilityMode(Ext.Element.DISPLAY).toggle(); return false;'>More</a><pre id='extended-error-info' style='display:none;overflow:auto;width:100%;height:200px;margin-top:5px'>"+Ext.util.Format.htmlEncode(errObj.extendedError)+"</pre>";}}}catch(e){ORYX.Log.error("ORYX.Plugins.MotivePlugin._doValidate()::An unexpected error has occurred. Possibly the request timed out.");}}
if(msg===""){msg=String.format(MOTV.I18N.ValidatePlugin.validateFailure,MOTV.I18N.ValidatePlugin.unexpectedError);msg2=msg;}
if(this.caller_id=='bld')
this.caller.facade.raiseEvent({type:ORYX.CONFIG.EVENT_LOADING_DISABLE,text:msg});if(this.ignoreParentFlows==false){Ext.Msg.show({title:MOTV.I18N.ValidatePlugin.title,msg:msg,buttons:Ext.Msg.OK,minWidth:500,icon:Ext.MessageBox.ERROR,fn:function(btn,text){}});}
else{var regexpValue=errObj.errorData.modelUri.slice(1,errObj.errorData.modelUri.length);var recordIndex=this.fmGrid.getStore().find("id",regexpValue);var rec=this.fmGrid.getStore().getAt(recordIndex);rec.set("puberrors",msg2);rec.set("state","failed");this.fmGrid.getSelectionModel().deselectRow(recordIndex,true,false,true);this.fmGrid.getView().refreshRow(rec);this._publishNextParent();}}};}();Ext.namespace("Motive");Motive.HTML_Editor={content_css:ORYX.engineContextPath+"/jawrcss/static/bundles/CommonCss.css",style_formats:[],formats:{alignleft:{selector:'p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li,table,img',classes:'left'},aligncenter:{selector:'p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li,table,img',classes:'center'},alignright:{selector:'p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li,table,img',classes:'right'},alignfull:{selector:'p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li,table,img',classes:'full'},bold:{inline:'span','classes':'bold','styles':{'fontWeight':'bold'}},italic:{inline:'span','classes':'italic','styles':{'fontStyle':'italic'}},underline:{inline:'span','classes':'underline',exact:true,'styles':{'textDecoration':'underline'}},strikethrough:{inline:'del',exact:true,'styles':{'textDecoration':'line-through'}},alert:{inline:'span','classes':'alert',exact:false,'styles':{'color':'red'}},copyright:{inline:'span','classes':'copyright',exact:false,'styles':{'fontWeight':'bold'}}}};